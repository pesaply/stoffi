<div class="white box" id="settings">	<h1><%=t "settings.title" %></h1>	<%= form_for(current_user, :url => edit_registration_path(current_user),		:html => { :method => :put }) do |f| %>				<% if any_errors?(resource) || (flash[:alert] && flash[:alert] != "") %>			<div class="notice">				<%= pretty_error(resource) %>				<%= flash[:alert] %>			</div>		<% end %>				<div>			<%= f.label :email %>			<%= f.email_field :email %>		</div>				<div class="text radio">			<%= f.label :name_source %>			<% @names.each do |provider,names| %>				<% names.each do |label,name| %>					<span class="choice">						<span class="label"><%= Link.pretty_name(provider) %></span>						<span class="control"><%= f.radio_button :name_source, "#{provider}::#{label}" %></span>						<span class="value"><%= name %></span>					</span>				<% end %>			<% end %>			<span class="choice">				<span class="label"><%=t "settings.custom" %></span>				<span class="control">					<%= f.radio_button :name_source, "" %>				</span>				<span class="value">					<%= f.decoded_text_field :custom_name, :autocomplete => :off %>				</span>			</span>		</div>				<div class="radio">			<%= f.label :image %>			<% @pics.each do |provider,picture| %>								<span class="choice">					<span class="value">						<%= image_tag picture, :width => 48, :height => 48 %>					</span>					<span class="label"><%= Link.pretty_name(provider) %></span>					<span class="control">						<%= f.radio_button :image, provider %>					</span>				</span>			<% end %>			<span class="choice">				<span class="value">					<%= image_tag "media/user.png", :width => 48, :height => 48 %>				</span>				<span class="label"><%=t "settings.default" %></span>				<span class="control">					<%= f.radio_button :image, "" %>				</span>			</span>		</div>				<div>			<%= f.label :show_ads %>			<%= f.select :show_ads, options_for_select([				[t("settings.ads.all"), "all"],				[t("settings.ads.text"), "text"],				[t("settings.ads.none"), "none"]			], current_user.show_ads) %>		</div>				<label>			<%= t(current_user.has_no_password? ? "settings.create_password" : "settings.change_password") %>		</label>		<%=check_box_tag "edit_password", "yes", false, :onclick => "togglePasswords();" %>				<div style="display:none;" id="edit_password_fields">			<% if current_user.has_password %>				<div>					<%= f.label :current_password %>					<%= f.password_field :current_plain %>					<%= f.hidden_field :current_password %>				</div>			<% end %>			<div>				<%= f.label :password %>				<%= f.password_field :plain, :onkeyup => "evaluatePassword();" %>				<div class="red note" style="display:none;" id="crack_time">					<span id="crack_time_text"></span>					<%= image_tag "gfx/tooltip.png", :id => "crack_time_img" %>				</div>				<%= f.hidden_field :password %>			</div>			<div>				<%= f.label :password_confirmation %>				<%= f.password_field :plain_confirmation %>				<%= f.hidden_field :password_confirmation %>			</div>		</div>	  		<div class="bottom right">			<%= button_tag t("settings.deregister"), leave_path, "",				:confirm => t("confirm"), :method => :delete %>							<%= button_tag t("save"), "hashPasswords();", "save", :color => :blue, :type => :form %>		</div>	<% end %></div>	<div class="white box" id="linksettings">	<% if text_ads? %>		<div class="ad">			<script type="text/javascript"><!--			google_ad_client = "ca-pub-5639501338860736";			/* Skyscraper */			google_ad_slot = "3985447558";			google_ad_width = 160;			google_ad_height = 600;			//-->			</script>			<script type="text/javascript"			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">			</script>		</div>	<% end %>	<h1><%=t "settings.links.title.existing" %></h1>	<table>	<% current_user.links.each do |link| %>		<tbody id="<%=link.provider%>" data-object="link-<%=link.id%>">			<tr data-row="header">				<td colspan="3" class="noborder">					<h2><%=link.display%></h2>				</td>			</tr>			<% p = "link-#{link.id}-" %>			<% if link.can_share? %>				<tr data-row="setting">					<td class="label"><%=t "settings.links.share.label"%></td>					<td class="info"><%=t "settings.links.share.info", :service => link.display %></td>					<td class="control">						<%= check_box_tag "share_#{link.provider}", "yes", link.do_share,							:data => { :field => p+"do_share" }, 							:onclick => "linkCheckboxClicked(#{link.id}, 'do_share', this);" %>					</td>				</tr>			<% end %>			<% if link.can_listen? %>				<tr data-row="setting">					<td class="label"><%=t "settings.links.listens.label"%></td>					<td class="info"><%=t "settings.links.listens.info", :service => link.display %></td>					<td class="control">						<%= check_box_tag "listen_#{link.provider}", "yes", link.do_listen,							:data => { :field => p+"do_listen" }, 							:onclick => "linkCheckboxClicked(#{link.id}, 'do_listen', this);" %>					</td>				</tr>			<% end %>			<% if link.can_create_playlist? %>				<tr data-row="setting">					<td class="label"><%=t "settings.links.playlists.label"%></td>					<td class="info"><%=t "settings.links.playlists.info", :service => link.display %></td>					<td class="control">						<%= check_box_tag "playlist_#{link.provider}", "yes", link.do_create_playlist,							:data => { :field => p+"do_create_playlist" }, 							:onclick => "linkCheckboxClicked(#{link.id}, 'do_create_playlist', this);" %>					</td>				</tr>			<% end %>			<% if link.can_donate? %>				<tr data-row="setting">					<td class="label"><%=t "settings.links.donations.label"%></td>					<td class="info"><%=t "settings.links.donations.info", :service => link.display %></td>					<td class="control">						<%= check_box_tag "donate_#{link.provider}", "yes", link.do_donate,							:data => { :field => p+"do_donate" }, 							:onclick => "linkCheckboxClicked(#{link.id}, 'do_donate', this);" %>					</td>				</tr>			<% end %>			<% if link.can_button? %>				<tr data-row="setting">					<td class="label"><%=t "settings.links.buttons.label"%></td>					<td class="info">						<%=t "settings.links.buttons.info",							:button => t("settings.links.buttons.#{link.provider}") %>					</td>					<td class="control">						<%= check_box_tag "button_#{link.provider}", "yes", link.show_button,							:data => { :field => p+"show_button" }, 							:onclick => "linkCheckboxClicked(#{link.id}, 'show_button', this);" %>					</td>				</tr>			<% end %>			<tr data-row="button">				<td colspan="3" class="noborder">					<%= button_tag t("settings.links.unlink"), link_path(link), "delete",						:class => :small,						:method => :delete,						:confirm => t("settings.links.confirm", :provider => link.display) %>				</td>			</tr>		</tbody>	<% end %>	</table>			<% if @new_links.length > 0 %>		<% if @current_user.links.count > 0 %>			<h2><%=t "settings.links.title.new" %></h2>		<% end %>				<% @new_links.each do |link| %>			<%= button_tag link[:name], link[:path], link[:img], :title => link[:title],				:color => :blue, :class => :small, :width => 120 %>		<% end %>	<% end %></div><% if current_user.is_admin? %>	<div class="blue box">		<h1>Admin</h1>		<%= button_tag t("translatee.list"), admin_translatees_path, "", :color => :blue %></p>	</div><% end %><%bots = 20000;speed = 1000000000;l = I18n.locale;l = :en if l == :us;bots = number_with_delimiter(bots, :locale => l);speed = number_to_human(speed, :locale => l).downcase;%>	<script>$(function(){	$(document).ready(function()	{		$("#crack_time_img").qtip({			content: "<%=t "notice.password.explanation", :botsize => bots, :speed => speed %>",			show: "mouseover",			hide: "mouseout",			style:			{				name: 'light',				tip: true			}		});	});});function togglePasswords(){	if ($('#edit_password').is(":checked"))		$('#edit_password_fields').show();	else		$('#edit_password_fields').hide();}togglePasswords();// set noborder class on last setting rowvar previousRow;$('#linksettings tr').each(function(i, e){	if ($(e).data('row') == "button")		previousRow.find('td').addClass('noborder');	previousRow = $(e);});// move all services without settings to end// and make them into a single row each$('#linksettings table tbody').each(function(i, element){	var e = $(element);	if (e.find('[data-row="setting"]').length == 0)	{		e.remove();		$('#linksettings table').append(e);		e.addClass('compact');		var button = e.find('[data-row="button"] td');		e.find('[data-row="header"] td').attr('colspan', '1');		button.remove();		e.find('[data-row="header"]').append(button);	}});</script>